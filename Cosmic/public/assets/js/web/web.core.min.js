var Web;function WebInterface(){this.web_document=null,this.pages_manager=null,this.ajax_manager=null,this.notifications_manager=null,this.hotel_manager=null,this.customforms_manager=null,this.init=function(){this.web_document=$("body"),this.hotel_manager=new WebHotelManagerInterface,this.hotel_manager.init(),this.pages_manager=new WebPagesManagerInterface,this.ajax_manager=new WebAjaxManagerInterface,this.pages_manager.init(),this.dialog_manager=new WebDialogManagerInterface,this.notifications_manager=new WebNotificationsManagerInterface,this.forms_handler(),this.links_handler(),this.init_responsive(),this.check_cookies()},this.forms_handler=function(){var t=this;this.web_document.on("submit","form:not(.default-prevent)",function(e){if(e.preventDefault(),"get"!==$(this).attr("method"))t.ajax_manager.post("/"+$(this).attr("action"),new FormData(this),null,$(this));else{var i=$(this).attr("action").replace(Site.url+"/","").replace(Site.url,"");t.pages_manager.load(i+"?"+$(this).serialize())}})},this.links_handler=function(){var t=this;this.web_document.on("click","a",function(t){("#"===$(this).attr("href")||$(this).hasClass("disabled"))&&t.preventDefault()}).on("mouseover","a:not([target])",function(){$(this).attr("href")&&($(this).attr("href")||$(this).attr("href").match(/^#/)||$(this).attr("target","_blank"))}).on("click","a:not([target])",function(e){if(e.preventDefault(),"#"!==$(this).attr("href")&&"javascript:;"!==$(this).attr("href")&&"javascript:void(0)"!==$(this).attr("href")&&void 0!==$(this).attr("href")){var i=$(this).attr("href");i||(i="home"),i.match(/^\#([A-z0-9-_]+)$/i)?window.location.hash=i:(window.location.pathname+window.location.search!=="/"+i||window.location.hash)&&t.pages_manager.load(i)}}).on("click",".login-dialog-button",function(){$.magnificPopup.open({items:{type:"inline",src:"#login-dialog"},callbacks:{open:function(){$(".rounded-input").keypress(function(t){13==t.which&&($.magnificPopup.close(),$("#login-request").unbind().click())})}},mainClass:"my-mfp-zoom-in"})}).on("click","#login-request",function(t){t.preventDefault();var e={username:$(".login-form [name=username]").val(),password:$(".login-form [name=password]").val(),remember_me:$(".login-form [name=remember_me]").is(":checked")};$.magnificPopup.close(),Web.ajax_manager.post("/home/login/request",e,function(t){"pincode_required"==t.status&&setTimeout(function(){Web.dialog_manager.create("confirm",Locale.web_fill_pincode,Locale.web_twostep,null,"pincode",function(t){e.pincode=t.toString(),Web.ajax_manager.post("/home/login/request",e),$.magnificPopup.close()})},500)})}).on("click",".about-dialog-button",function(){$.magnificPopup.open({items:{type:"inline",src:"#about-dialog"},removalDelay:300,mainClass:"my-mfp-zoom-in"})}).on("click","[data-close-popup = 'true']",function(){$.magnificPopup.close()}).on("click",".fa-flag",function(){if(User.is_logged){var t=$(this).attr("data-report");$.magnificPopup.open({items:{type:"inline",src:"#report-item"},removalDelay:300,mainClass:"my-mfp-zoom-in"}),$("#reportForm").attr("action","ajax/report/"+t),$("#reportItemid").val($(this).attr("data-id"))}else Web.notifications_manager.create("error",Locale.web_login,Locale.web_loggedout)}).on("click",".fa-times-circle",function(){if(User.is_logged){var e=$(this).attr("data-id");t.ajax_manager.post("/ajax/report/photo",{itemId:e},function(t){"success"==t.status&&($(".photos[data-id="+e+"]").empty(),$.magnificPopup.close())})}})},this.init_responsive=function(){var t=this;this.web_document.find(".navigation-container").after('<nav class="mobile-navigation-container"><ul class="navigation-menu"></ul></nav>'),this.web_document.find(".navigation-container .navigation-menu .navigation-item:not(.main-link-item):not(.navigation-right-side-item)").each(function(){var t=$(this).clone().appendTo(".mobile-navigation-container .navigation-menu");t.removeClass("selected").removeAttr("data-category"),t.hasClass("has-items")&&t.children("a").attr("href","#")}),$('<li class="navigation-item mobile-menu cant-select">Menu</li>').prependTo(".navigation-container .navigation-menu").click(function(){t.web_document.find(".mobile-navigation-container").finish().slideToggle(),t.web_document.find(".mobile-navigation-container .navigation-item.has-items .navigation-submenu").finish().slideUp()}),this.web_document.find(".mobile-navigation-container .navigation-item.has-items>a").click(function(){t.web_document.find(".mobile-navigation-container .navigation-item.has-items").not($(this).parent()).find(".navigation-submenu").finish().slideUp(),$(this).parent().find(".navigation-submenu").finish().slideToggle()}),this.web_document.find(".mobile-navigation-container a").click(function(){"#"!==$(this).attr("href")&&(t.web_document.find(".mobile-navigation-container .navigation-item.has-items .navigation-submenu").finish().slideUp(),t.web_document.find(".mobile-navigation-container").finish().slideUp())})},this.check_cookies=function(){void 0===Cookies.get("allow_cookies")&&(this.web_document.find(".cookies-accept-container").show(),this.web_document.find(".cookies-accept-container .close-container").click(function(){Cookies.set("allow_cookies",!0,{expires:365}),$(this).parent().hide()}))}}function WebPagesManagerInterface(){this.current_page_url=null,this.current_page_interface=null,this.last_page_url="home",this.page_container=null,this.init=function(){var t=this;this.page_container=$(".page-container"),this.current_page_url=window.location.pathname.substr(1)+window.location.search,this.current_page_interface=new WebPageInterface(this,this.page_container.attr("data-page")),this.current_page_interface.assign_interface(),""===this.current_page_url&&(this.current_page_url="home"),this.current_page_url.match(/^hotel/)&&User.is_logged&&Web.hotel_manager.open_hotel(this.current_page_url),History.Adapter.bind(window,"statechange",function(){var e=History.getState().url.replace(document.location.origin,"").substring(1);t.current_page_url!==e&&("/"===e?t.load("home",null,!1,null,!1):t.load("/"+e,null,!1,null,!1)),t.current_page_url=e})},this.push=function(t,e,i){t=t.replace(/^\/|\/$/g,""),this.current_page_url=t,i?History.replaceState(null,e||Site.name,"/"+t):History.pushState(null,e||Site.name,"/"+t)},this.load=function(t,e,i,n,a,o){void 0===i&&(i=!0),void 0===a&&(a=!0),void 0===o&&(o=!1);var s=this,c=$("body");""===t&&(t="home"),"/"!==t.charAt(0)&&(t="/"+t),this.last_page_url=this.current_page_url,t.match(/^\/hotel/)?User.is_logged&&(Web.hotel_manager.open_hotel(t.replace("hotel?","").replace("hotel","")),s.push(t,"Hotel - "+Site.name,!1)):(PageLoading.show(),$.ajax({type:"get",url:t,dataType:"json",error:function(t,e,i){PageLoading.hide(),Web.notifications_manager.create("error",i,t.responseText)}}).done(function(e){if(PageLoading.hide(),e.location)return window.location=e.location,null;isEmpty(e.status)||isEmpty(e.message)||Web.notifications_manager.create(e.status,e.message,e.title?e.title:null,Number.isInteger(e.timer)?e.timer:void 0,e.link?e.link:null),e.dialog?Web.dialog_manager.create("default",e.dialog,e.title,null,null):(e.loadpage?s.load(e.loadpage):e.replacepage?s.load(e.replacepage,null,!0,null,!0,!0):(s.current_page_interface=new WebPageInterface(s,e.id,i,e),s.current_page_interface.build(),"function"==typeof n&&n(e)),c.hasClass("hotel-visible")&&c.removeClass("hotel-visible"),window.location.pathname+window.location.search!=="/"+t&&(document.title=e.title,s.push(t,e.title,!1)))}))}}function WebPageInterface(t,e,i,n){void 0===i&&(i=!0),this.manager=t,this.type=e,this.scroll=i,this.page_data=n,this.page_interface=null,this.build=function(){if(null!==this.page_data){this.manager.page_container.attr("data-page",this.type).html(this.page_data.content);var t=$(".navigation-container"),e=this.type.substr(0,this.type.lastIndexOf("_"));isEmpty(e)&&(e=this.type),t.find(".navigation-item.selected:not([data-category='"+e+"'])").removeClass("selected"),t.find(".navigation-item[data-category='"+e+"']").addClass("selected"),this.manager.current_page_url.indexOf("forum")>=0||this.scroll&&$("html, body").animate({scrollTop:t.offset().top},300),this.assign_interface()}},this.assign_interface=function(){"home"===this.type?this.page_interface=new WebPageHomeInterface(this):"registration"===this.type?this.page_interface=new WebPageRegistrationInterface(this):"article"===this.type?this.page_interface=new WebPageArticleInterface(this):"shop"===this.type?this.page_interface=new WebPageShopInterface(this):"shop_offers"===this.type?this.page_interface=new WebPageShopOffersInterface(this):"help_requests"===this.type?this.page_interface=new WebPageHelpRequestsInterface(this):"help_new"===this.type?this.page_interface=new WebPageHelpRequestsInterface(this):"profile"===this.type?this.page_interface=new WebPageProfileInterface(this):"community_photos"===this.type?this.page_interface=new WebPageCommunityPhotosInterface(this):"community_value"===this.type?this.page_interface=new WebPageCommunityValueInterface(this):"jobs"===this.type?this.page_interface=new WebPageJobsInterface(this):"settings_preferences"===this.type?this.page_interface=new WebPageSettingsInterface(this):"settings_namechange"===this.type?this.page_interface=new WebPageSettingsNamechangeInterface(this):"settings_verification"===this.type?this.page_interface=new WebPageSettingsVerificationInterface(this):"password_claim"===this.type?this.page_interface=new WebPagePasswordClaimInterface(this):"forum"===this.type&&(this.page_interface=new WebPageForumInterface(this)),null!==this.page_interface&&this.page_interface.init()},this.get_page_container=function(){return this.manager.page_container},this.update=function(){}}function WebAjaxManagerInterface(){this.get=function(t,e){PageLoading.show(),$.ajax({type:"get",url:t,dataType:"json",processData:!1,contentType:!1,error:function(t,e,i){PageLoading.hide(),Web.notifications_manager.create("error",i,t.responseText)}}).done(function(t){PageLoading.hide(),"function"==typeof e&&e(t)})},this.post=function(t,e,i,n){if(!(e instanceof FormData)){if(!(e instanceof Object))return;var a=e;for(var o in e=new FormData,a)a.hasOwnProperty(o)&&e.append(o,a[o])}void 0!==n&&"login"===n.attr("action")&&e.append("return_url",window.location.href),PageLoading.show(),"/"!==t.charAt(0)&&(t="/"+t),$.ajax({type:"post",url:t,data:e,dataType:"json",processData:!1,contentType:!1}).done(function(t){if(PageLoading.hide(),t.location)return window.location=t.location,null;t.pagetime&&setTimeout(function(){window.location=t.pagetime},2500),t.loadpage&&Web.pages_manager.load(t.loadpage),t.replacepage&&Web.pages_manager.load(t.replacepage,null,!0,null,!0,!0),t.modal&&$.magnificPopup.open({closeOnBgClick:!1,items:[{modal:!0,src:"/popup/"+t.modal,type:"ajax"}]},0),t.close_popup&&$.magnificPopup.close(),void 0!==n&&(t.captcha_error||n.find(".registration-recaptcha").removeClass("registration-recaptcha").removeAttr("data-sitekey").removeAttr("data-callback")),isEmpty(t.status)||isEmpty(t.message)||Web.notifications_manager.create(t.status,t.message,t.title?t.title:null,Number.isInteger(t.timer)?t.timer:void 0,t.link?t.link:null),"function"==typeof i&&i(t)})}}function WebNotificationsManagerInterface(){this.titles_configutation={success:Locale.web_notifications_success,error:Locale.web_notifications_error,info:Locale.web_notifications_info},this.notifications={},this.create=function(t,e,i,n,a){var o=((new Date).getTime()+Math.floor(1e4*Math.random()+1)).toString(16);void 0===n&&(n=5),this.notifications[o]=new WebNotificationInterface(this,o,t,e,i,n,a),this.notifications[o].init()},this.destroy=function(t){if(!this.notifications.hasOwnProperty(t))return null;this.notifications[t].notification.remove(),delete this.notifications[t]}}function WebNotificationInterface(t,e,i,n,a,o,s){this.manager=t,this.id=e,this.type=i,this.message=n,this.title=a,this.timer=o,this.link=s,this.notification=null,this.timeout=null,this.init=function(){var t=this,e=['<div class="notification-container" data-id="'+this.id+'" data-type="'+this.type+'">\n    <a href="#" class="notification-close"></a>\n    <div class="notification-title">'+(null!=this.title?this.title:this.manager.titles_configutation[this.type])+'</div>\n    <div class="notification-content">'+this.message+"</div>\n</div>"].join("");this.notification=$(e).appendTo(".notifications-container"),this.notification.find(".notification-close").click(function(){t.close()}),null!==this.link&&this.notification.click(function(){if($(this).hasClass("notification-close"))return null;var e=t.link.replace(Site.url+"/","").replace(Site.url,"");e||(e="home"),Web.page_container.load(e)}),0!==this.timer&&this.notification.hover(function(){clearTimeout(t.timeout)},function(){t.timeout=setTimeout(function(){t.close()},1e3*t.timer)}),this.show()},this.show=function(){var t=this;0===this.timer?this.notification.fadeIn():(this.notification.fadeIn(),this.timeout=setTimeout(function(){t.close()},1e3*this.timer))},this.close=function(){var t=this;this.notification.animate({opacity:0},300,function(){$(this).slideUp(400,function(){t.manager.destroy(t.id)})})}}function WebDialogManagerInterface(){this.buttons=null,this.input=null,this.type=null,this.title=null,this.content=null,this.callback=null,this.create=function(t,e,i,n,a,o){this.buttons={cancel:Locale.web_dialog_cancel,confirm:Locale.web_dialog_validate},this.type=null,this.title=null,this.content=null,this.input=null,this.callback=null,this.type=t,this.title=void 0===i?Locale.web_dialog_confirm:i,this.content=e,this.callback=o,this.input=a,void 0!==n&&this.assign_buttons(n),this.build()},this.build=function(){var t=this,e=['<div class="'+this.type+'-popup dialog-popup zoom-anim-dialog">\n    <h3>'+this.title+"</h3>\n    "+this.content+'\n    <div class="input-container"></div>    <div class="buttons-container"></div></div>'].join(""),i=$(e);i.find(".buttons-container").append('<button class="rounded-button '+("confirm"===this.type?"red":"lightblue")+' cancel">'+this.buttons.cancel+"</button>"),null!==this.input&&i.find(".input-container").append('<br /><input type="text" class="'+this.input+' rounded-input purple-active dialog-input">'),"confirm"===this.type&&i.find(".buttons-container").append('<button class="rounded-button red plain confirm">'+this.buttons.confirm+"</button>"),$.magnificPopup.open({modal:"confirm"===this.type,items:{src:i,type:"inline"},callbacks:{open:function(){var e=$(this.content);e.unbind().on("click",".confirm",function(){var e=$(".dialog-input").map(function(){return $(this).val()}).toArray();$.magnificPopup.close(),$(document).off("keydown",i),"function"==typeof t.callback&&t.callback(e)}).on("click",".cancel",function(){$.magnificPopup.close(),$(document).off("keydown",i)});var i=function(t){return 13===t.keyCode?(e.find(".confirm").click(),!1):27===t.keyCode?(e.find(".cancel").click(),!1):void 0};$(document).on("keydown",i)}}})},this.assign_buttons=function(t){for(var e in t)t.hasOwnProperty(e)&&(this.buttons[e]=t[e])}}$(function(){(Web=new WebInterface).init()});